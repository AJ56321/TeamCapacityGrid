<!DOCTYPE html>
<html>
<head>
    <title>TeamCapacityGrid</title>

    <script type="text/javascript" src="/apps/2.0rc2/sdk.js"></script>

    <script type="text/javascript">
    var app;
        Rally.onReady(function () {
                Ext.define("CustomApp",{extend:"Rally.app.TimeboxScopedApp",componentCls:"app",scopeType:"iteration",html:'<div title="Capacity records are only created from the Team Status page. Making an initial entry there allows the display and edit here."><h1>Goto Track->Team Status Page to enter initial Capacities</h1></div>',comboboxConfig:{fieldLabel:'<div align="right"><input type="button" value="Refresh" onClick="javascript: app._loadGrid();"/> &nbsp;&nbsp;&nbsp;&nbsp;Select an Iteration:</div>',labelWidth:200,width:500},addContent:function(){this._showMask("Loading"),this._loadGrid()},onScopeChange:function(){this._showMask("Updating"),this._loadGrid()},_loadGrid:function(){var context=this.getContext();pageSize=25,fetch="User,Capacity,TaskEstimates,Load",iOID=this.getContext().getTimeboxScope().getRecord().get("ObjectID"),this._myGrid&&this._myGrid.destroy(),this._myGrid=Ext.create("Rally.ui.grid.Grid",{xtype:"rallygrid",layout:"fit",enableColumnHide:!1,showRowActionsColumn:!1,enableEditing:!0,context:this.getContext(),storeConfig:{fetch:fetch,model:"UserIterationCapacity",filters:this._getFilters(iOID),pageSize:pageSize,listeners:{datachanged:function(){},scope:this},sorters:[{property:"User",direction:"ASC"}]},columnCfgs:[{text:"User",dataIndex:"User",flex:1},{text:"Capacity",dataIndex:"Capacity"},{text:"Task Estimates",dataIndex:"TaskEstimates"},{text:"Load",xtype:"templatecolumn",tpl:Ext.create("Rally.ui.renderer.template.progressbar.ProgressBarTemplate",{percentDoneName:"Load",calculateColorFn:function(recordData){return colVal=.8>recordData.Load?"#B2E3B6":1>recordData.Load?"#FBDE98":"#FCB5B1"}})}],pagingToolbarCfg:{pageSizes:[pageSize]}}),this._hideMask(),app=this,this.add(this._myGrid)},_getFilters:function(iName){var filters=[];return filters.push({property:"Iteration.ObjectID",operator:"=",value:iName}),filters.push({property:"Capacity",operator:">",value:0}),filters},_showMask:function(msg){this.getEl()&&(this.getEl().unmask(),this.getEl().mask(msg))},_hideMask:function(){this.getEl().unmask()}});

            Rally.launchApp('CustomApp', {
                name:"TeamCapacityGrid",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        .app {
     /* Add app styles here */
}

    </style>
</head>
<body></body>
</html>
